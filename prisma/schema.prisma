datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Market {
  marketId        BigInt   @id
  configUri       String?
  configUriHash   String?
  createdAtBlock  BigInt?
  createdAtTime   DateTime?
  // cached model labels (so the UI can render without chain calls)
  modelsJson      Json?    // [{ idx, familyName, modelName, commitHash }]

  winningModelIdx BigInt?
  status          Int?     // if you later call marketStatus()

  trades          Trade[]
}

model Trade {
  id              String   @id // `${txHash}:${logIndex}`
  txHash          String
  logIndex        Int
  blockNumber     BigInt
  blockTime       DateTime

  marketId        BigInt
  modelIdx        BigInt
  trader          String
  isBuy           Boolean

  tokensDelta     Decimal  @db.Numeric(78, 0)
  sharesDelta     Decimal  @db.Numeric(78, 0)

  modelNewPrice   Decimal  @db.Numeric(78, 0) // UD60x18, store raw
  modelNewSupply  Decimal  @db.Numeric(78, 0)
  marketNewSupply Decimal  @db.Numeric(78, 0)

  market          Market   @relation(fields: [marketId], references: [marketId])

  @@index([marketId, blockTime])
  @@index([trader, blockTime])
  @@index([txHash])
}

model IndexerState {
  id              String   @id @default("delphi")
  lastBlock       BigInt
  updatedAt       DateTime @updatedAt
}
