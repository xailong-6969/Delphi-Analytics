datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Market {
  marketId        BigInt   @id
  configUri       String?
  configUriHash   String?
  createdAtBlock  BigInt?
  createdAtTime   DateTime?
  modelsJson      Json?

  winningModelIdx BigInt?
  status          Int?

  trades          Trade[]
}

model Trade {
  id              String   @id
  txHash          String
  logIndex        Int
  blockNumber     BigInt
  blockTime       DateTime

  marketId        BigInt
  modelIdx        BigInt
  trader          String
  isBuy           Boolean

  tokensDelta     Decimal  @db.Decimal(78, 0)
  sharesDelta     Decimal  @db.Decimal(78, 0)

  modelNewPrice   Decimal  @db.Decimal(78, 0)
  modelNewSupply  Decimal  @db.Decimal(78, 0)
  marketNewSupply Decimal  @db.Decimal(78, 0)

  market          Market   @relation(fields: [marketId], references: [marketId])

  @@index([marketId, blockTime])
  @@index([trader, blockTime])
  @@index([txHash])
}

model IndexerState {
  id        String   @id @default("delphi")
  lastBlock BigInt
  updatedAt DateTime @updatedAt
}
